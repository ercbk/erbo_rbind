---
title: A Baseball Dashboard in Time for Baseball Season
author: Eric Book
date: '2018-03-09'
slug: a-baseball-dashboard-in-time-for-baseball-season
categories:
  - shiny
  - sports-analysis
  - scraping
  - eda
tags:
  - shiny
  - outliers
  - rvest
  - ggridges
  - DT
draft: FALSE
output:
      blogdown::html_page:
            toc: true
            toc_depth: 1
---



```{r emo, include=FALSE}
library(emo)
```


``` {r, echo=FALSE}
blogdown::shortcode("tweet", "900017684590579713")
```


```{r echo=FALSE}
blogdown::shortcode("tweet", "900033162771910656")
```

Baseball fan? `r emo::ji("white_check_mark")` Math? `r emo::ji("white_check_mark")` Computers skills? `r emo::ji("white_check_mark")`

It's always nice when project ideas fall into your lap. Let's build an dashboard that can be used to evaluate the 2018 Reds Hall of Fame nominees.

## JAWS

For the uninitiated, the first thing you need to understand is *WAR*. [WAR](https://www.fangraphs.com/library/misc/war/) attempts to encapsulate a player's yearly contribution into one statistic. *JAWS* is calculated by taking the average of a player's total WAR over their career and the sum of their seven highest WAR values. The JAWS statistic is meant to be a starting point in the discussion of a nominee's creditials for the Hall of Fame. Jaffe provides a thorough explanation [here](https://www.si.com/mlb/2017/11/27/hall-fame-jaws-intro-2018-ballot). There's also a more succinct description at [Baseball-Reference](https://www.baseball-reference.com/about/jaws.shtml).

The question is can JAWS, whose domain of applicability is the MLB Hall of Fame, be applied to a franchise's Hall of Fame. Instead of career WAR, we'll be using WAR the player accrued while he played for the Cincinnati Reds. The likely sticking point is the seven year qualification since free agency makes it less likely that players remain with a team for that length of duration. The number of inductees in a franchise hall of fame probably is considerably less than the MLB hall of fame, so the trick will be to chose a tenure long enough to qualify a high percentage of the inductees and still allow JAWS to provide an adequate measure.



## Scrape Hall of Fame Inductee Names


First, we need to get the names of the members of the Reds Hall of Fame. There are a few places with this information including the Reds Hall of Fame website, Baseball-Reference, and Wikipedia. None had the information available to download or presented it in a tidy format. Wikipedia is a source that has wide-ranging utility. This is a good opportunity to become familiar with scraping the website. 


![](/charts/copy_xpath.gif)


Honestly, I expected this part to be more of a hassle, but `rvest` made the process quite painless. Use Google Chrome's inspect feature to obtain the xpath by scrolling down to the table with the member names, right-clicking on the page, and clicking inspect. In the left panel under the Elements tab, you'll see HTML code. Hovering over each line will shade an object on the page. Once we find the line of code that corresponds to the table we want, we right-click that line of code, choose copy, and copy xpath.


```{r scrape, message=FALSE}

library(tidyverse)
library(rvest)

url <- "https://en.wikipedia.org/wiki/Cincinnati_Reds_Hall_of_Fame_and_Museum#Cincinnati_Reds_Hall_of_Fame_members"
members <- url %>%
      read_html() %>%
      html_nodes(xpath='//*[@id="mw-content-text"]/div/table[2]') %>%
      html_table()
members <- members[[1]]

```


```{r scrape-str}
glimpse(members)
```


* Year is the year inducted into the Reds HOF.
* No. is the number on the back of player's jersey.
* Inductee is the player's name.
* Position is the positions played.
* Tenure is the number of years played as a Red and is formatted as a range


For our calculation, we'll need Inductee, Position, and Tenure. There are formatting problems with Position and Tenure, but that information can be obtained elsewhere.

There are only five nominees in the 2018 class so we can just copy/paste their information from the [announcement](http://www.cincinnati.com/story/sports/mlb/reds/2017/08/21/candidates-announced-2018-reds-hall-fame-ballot/586540001/): third baseman Aaron Boone (1997-2003), outfielder Adam Dunn (2001-2008), pitcher John Franco 
(1984-1989),pitcher Danny Graves (1997-2005), third baseman Scott Rolen (2009-2012) and outfielder 
Reggie Sanders (1991-1998).



## WAR Values


To get our WAR values, we'll utilize two data sets from the `openWARData` package: idTT (player IDs) and rWAR (Baseball-Reference WAR). Our member names are used to filter the idTT data to get IDs and the IDs to filter the rWAR data to get the WAR values.


```{r idtt, message=FALSE}
library(openWARData)

# Combining first and last names to match the member names we scraped
idTTa <- idTT %>%
      select(key_bbref, name_last, name_first) %>%
      mutate(name_whole = paste(name_first, name_last))

# Missing values come along for the ride so they need removed
indID <- map_dfr(members[,"Inductee"], function(x) filter(idTTa, name_whole == x & key_bbref != ""))

```


Some players were excluded from `indID` because in `members`, they have accent marks in their names. Likewise, a father/son duo who have the same names in `idTT` but have Sr/Jr suffixes in `members`. All of these players will be added to `indID`. Also, administrative personnel were removed during the filtering process, since obviously, they have no WAR values.


```{r id-missname}
missNamList <- list("Dolf Luque", "Leo Cardenas", "Tony Perez", "Dave Concepcion", "Ken Griffey",
                    "Jose Rijo", "Cesar Geronimo", "Pedro Borbon")
indID <- map_dfr(missNamList, function(x) filter(idTTa, name_whole == x & key_bbref != "")) %>% 
      bind_rows(indID)
```


Not many people have original names, including baseball players, so we need to remove the extra Pete Rose (Jr.), Joe Morgan, Mike McCormick, and George Wright. Sparky Anderson and Fred Hutchinson were managers so they can be dropped as well.


```{r id-rm}
indID <- filter(indID, key_bbref != "rosepe02" & key_bbref != "morgajo01"
                    & key_bbref != "mccormi03" & key_bbref != "andersp01" 
                    & key_bbref != "wrighge03" & key_bbref != "hutchfr01")
glimpse(indID)
```


Now for the nominees,

```{r id-nom}
nomNamList <- list("Aaron Boone", "Adam Dunn", "John Franco", "Danny Graves", "Scott Rolen",
                   "Reggie Sanders")
nomID <- map_dfr(nomNamList, function(x) filter(idTTa, name_whole == x & key_bbref != ""))

# Snagged an extra Reggie Sanders
nomID <- filter(nomID, key_bbref != "sandere01")
```


We have IDs for the inductees and nominees, so now we can get those WAR values. Also, we only want the seasons played in a Reds uniform.

```{r war-val}

# Inductees
indWar <- map_dfr(as.character(indID$key_bbref), function(x) filter(rWAR, playerId == x)) %>%
      select(playerId, yearId, teamId, rWAR) %>%
      mutate_if(is.factor, as.character) %>% 
      filter(teamId == "CIN")

# Nominees
nomWar <- map_dfr(as.character(nomID$key_bbref), function(x) filter(rWAR, playerId == x)) %>%
      select(playerId, yearId, teamId, rWAR) %>%
      mutate_if(is.factor, as.character) %>% 
      filter(teamId == "CIN")

glimpse(indWar)
```



## EDA


Words

```{r eda-ind-yrs}
# Inductees
indYrs <- indWar %>%
      group_by(playerId) %>% 
      summarize(tenure = n())
table(indYrs$tenure)
```


```{r eda-nom-yrs}
# Nominees
nomYrs <- nomWar %>%
      group_by(playerId) %>% 
      summarize(tenure = n())
table(nomYrs$tenure)
```

